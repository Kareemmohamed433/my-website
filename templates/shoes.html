<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø£Ø­Ø°ÙŠØ©</title>
  <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <style>
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø«Ø§Ø¨Øª ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© */
    nav.navbar {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1100;
    }
    /* ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„ÙŠØ¸Ù‡Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .page-container {
      margin-top: 80px;
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ */
    .product-card {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      margin-bottom: 20px;
      border-radius: 5px;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .product-card.animate {
      opacity: 1;
      transform: translateY(0);
    }
    .product-card img {
      max-width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .sale-badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: red;
      color: white;
      padding: 5px 10px;
      font-size: 14px;
      font-weight: bold;
      border-radius: 5px;
    }
    .return-btn {
      display: block;
      width: 200px;
      margin: 20px auto;
    }
    /* Ø´Ø¹Ø§Ø± Ø§Ù„Ø³Ù„Ø© Ù…Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
    .cart-logo {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      z-index: 1200;
    }
    .cart-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: red;
      color: white;
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 50%;
    }
    /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© */
    .confirmation-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 16px;
      z-index: 1200;
      display: none;
    }
  </style>
</head>

<body>
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ (Ø§Ù„Ù‡ÙŠØ¯Ø±) ÙŠØ¸Ù‡Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/">Ø§Ù„Ù…ØªØ¬Ø±</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent" 
              aria-controls="navbarContent" aria-expanded="false" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="/">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li class="nav-item"><a class="nav-link" href="/shop">Ø§Ù„Ù…ØªØ¬Ø±</a></li>
          <li class="nav-item"><a class="nav-link" href="/cart">Ø§Ù„Ø³Ù„Ø© <span id="cart-count-nav" class="cart-badge">0</span></a></li>
          <li class="nav-item"><a class="nav-link" href="/blog">Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Ø§Ù„ÙØ¦Ø§Øª</a>
            <div class="dropdown-menu" aria-labelledby="categoryDropdown">
              <a class="dropdown-item" href="/shoes">Ø§Ù„Ø£Ø­Ø°ÙŠØ©</a>
              <a class="dropdown-item" href="/clothes">Ø§Ù„Ù…Ù„Ø§Ø¨Ø³</a>
              <a class="dropdown-item" href="/watches">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>

  <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ø³Ù„Ø© Ù…Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
  <div class="cart-logo" id="cartLogo" onclick="goToCart()">
    ğŸ›’
    <span id="cart-count" class="cart-badge">0</span>
  </div>

  <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ -->
  <div id="confirmation-message" class="confirmation-message">âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©!</div>

  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© -->
  <div class="container page-container">
    <h2 class="text-center">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø°ÙŠØ©</h2>
    <div class="row" id="shoes-list"></div>
    <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <button class="btn btn-secondary return-btn" onclick="goToHome()">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù€ API
      fetch("/api/products?category=shoes")
        .then(response => response.json())
        .then(products => {
          console.log("âœ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©:", products);
          const shoesContainer = document.getElementById("shoes-list");
          shoesContainer.innerHTML = "";

          // ÙØ±Ø² Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø­ÙŠØ« ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®ØµÙ… Ø£ÙˆÙ„Ø§Ù‹
          products.sort((a, b) => (b.discount || 0) - (a.discount || 0));

          products.forEach(product => {
            let discountPrice = product.discount
              ? (product.price - (product.price * product.discount / 100)).toFixed(2)
              : null;
            let offerBadge = product.discount
              ? `<span class="sale-badge">ğŸ”´ Ø®ØµÙ… ${product.discount}%</span>`
              : "";

            let productHTML = `
              <div class="col-md-4">
                <div class="product-card">
                  ${offerBadge}
                  <img src="${product.image}" alt="${product.name}">
                  <h5>${product.name}</h5>
                  <p>${product.description}</p>
                  ${
                    discountPrice
                      ? `<p><del>ğŸ’² $${product.price}</del> <strong>ğŸ’² $${discountPrice}</strong></p>`
                      : `<p>ğŸ’² Ø§Ù„Ø³Ø¹Ø±: $${product.price}</p>`
                  }
                  <button class="btn btn-primary" onclick="addToCart('${product.id}')">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
                </div>
              </div>`;
            shoesContainer.innerHTML += productHTML;
          });

          // Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ ØªÙØ¹ÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚
          const productCards = document.querySelectorAll('.product-card');
          const observerOptions = { threshold: 0.3 };
          const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.classList.add('animate');
                observer.unobserve(entry.target);
              }
            });
          }, observerOptions);
          productCards.forEach(card => {
            observer.observe(card);
          });
        })
        .catch(error => console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", error));

      // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
      updateCartCount();

      // ØªÙØ¹ÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø³Ø­Ø¨ Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø³Ù„Ø©
      makeDraggable(document.getElementById("cartLogo"));
    });

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
    function addToCart(productId) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let existingProduct = cart.find(item => item.id === productId);
      if (existingProduct) {
        existingProduct.quantity++;
      } else {
        cart.push({ id: productId, quantity: 1 });
      }
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      showConfirmationMessage();
    }

    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø©
    function updateCartCount() {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let cartCount = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById("cart-count").innerText = cartCount;
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
    function showConfirmationMessage() {
      const messageElement = document.getElementById("confirmation-message");
      messageElement.style.display = "block";
      setTimeout(() => {
        messageElement.style.display = "none";
      }, 3000);
    }

    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©
    function goToCart() {
      window.location.href = "/cart";
    }

    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    function goToHome() {
      window.location.href = "/";
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨
    function makeDraggable(el) {
      let posX = 0, posY = 0, mouseX = 0, mouseY = 0;
      el.onmousedown = dragMouseDown;
      
      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        mouseX = e.clientX;
        mouseY = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }
      
      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        posX = mouseX - e.clientX;
        posY = mouseY - e.clientY;
        mouseX = e.clientX;
        mouseY = e.clientY;
        el.style.top = (el.offsetTop - posY) + "px";
        el.style.left = (el.offsetLeft - posX) + "px";
      }
      
      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
  </script>

  <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø³ÙƒØ±Ø¨ØªØ§Øª Bootstrap Ùˆ Popper -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</body>
</html>
